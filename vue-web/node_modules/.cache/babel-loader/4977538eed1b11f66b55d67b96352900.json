{"ast":null,"code":"import { message } from 'ant-design-vue';\nimport md5 from 'js-md5';\nimport { defineComponent, reactive } from 'vue';\nexport default defineComponent({\n  setup() {\n    const formState = reactive({\n      username: '',\n      password: '',\n      remember: false\n    });\n\n    let validateName = async (_rule, value) => {\n      if (value === '') {\n        return Promise.reject('请输入正确格式账户名');\n      } else if (value.length != value.split(\" \").join(\"\").length) {\n        return Promise.reject('输入包含空格');\n      } else {\n        return Promise.resolve();\n      }\n    };\n\n    let validatePass = async (_rule, value) => {\n      if (value === '') {\n        return Promise.reject('请输入初始密码');\n      } else if (value.length != value.split(\" \").join(\"\").length) {\n        return Promise.reject('输入包含空格');\n      } else {\n        return Promise.resolve();\n      }\n    };\n\n    const rules = {\n      password: [{\n        required: true,\n        validator: validatePass,\n        trigger: 'change'\n      }],\n      username: [{\n        validator: validateName,\n        trigger: 'change'\n      }]\n    };\n\n    const onFinish = values => {\n      console.log('Success:', values);\n    };\n\n    const onFinishFailed = errorInfo => {\n      console.log('Failed:', errorInfo);\n    };\n\n    return {\n      rules,\n      formState,\n      onFinish,\n      onFinishFailed\n    };\n  },\n\n  mounted() {\n    let Base64 = require('js-base64').Base64;\n\n    let username = localStorage.getItem(\"user\");\n\n    if (username) {\n      this.formState.username = localStorage.getItem(\"user\");\n      this.formState.password = Base64.decode(localStorage.getItem(\"password\")); // base64解密\n\n      this.formState.remember = true;\n    }\n  },\n\n  created() {\n    console.log(this.$route.params);\n  },\n\n  methods: {\n    // str2hex(str) {\n    //   if (str === \"\") {\n    //     return \"\";\n    //   }\n    //   else {\n    //     var arr = [];\n    //     //arr.push(\"0x\");\n    //     for (var i = 0; i < str.length; i++) {\n    //       arr.push(str.charCodeAt(i).toString(16));\n    //     }\n    //     return arr.join('');\n    //   }\n    // },\n    login() {\n      // console.log(\"dddddd\",this.str2hex(\"ddd\"))\n      if (this.formState.username === '' || this.formState.password == '' || this.formState.username.length !== this.formState.username.split(\" \").join(\"\").length || this.formState.password.length !== this.formState.password.split(\" \").join(\"\").length) {\n        message.destroy();\n        message.error('登录错误，请检查输入格式', 3);\n      } else {\n        var pass_word = md5(this.formState.password);\n        this.$http.post('http://192.168.5.42:9999/login', {\n          name: this.formState.username,\n          password: pass_word\n        }).then(response => {\n          if (response.data.result === 'success') {\n            sessionStorage.setItem('user', this.formState.username);\n            sessionStorage.setItem('pass', pass_word);\n            sessionStorage.setItem('token', response.data.token);\n            sessionStorage.setItem('uid', response.data.uid); // sessionStorage.setItem('uid', 'aa')\n\n            if (this.formState.remember) {\n              let Base64 = require('js-base64').Base64;\n\n              let password = Base64.encode(this.formState.password); // base64加密\n\n              localStorage.setItem(\"user\", this.formState.username);\n              localStorage.setItem(\"password\", password);\n            } else {\n              localStorage.removeItem(\"user\");\n              localStorage.removeItem(\"password\");\n            }\n\n            message.destroy();\n            message.success('登录成功', 3);\n            this.$router.push('/overview');\n          }\n\n          if (response.data.result === 'none') {\n            message.destroy();\n            message.warning('用户名不存在，请注册', 3);\n          }\n\n          if (response.data.result === 'fail') {\n            message.destroy();\n            message.error('登录失败，密码错误', 3);\n          }\n\n          if (response.data.result === 'error') {\n            message.destroy();\n            message.warning('登录出错', 3);\n          }\n        }).catch(function (error) {\n          // 请求失败处理\n          console.log(error);\n        });\n      }\n    }\n\n  }\n});","map":{"version":3,"mappings":"AAyDA,SAASA,OAAT,QAAwB,gBAAxB;AACA,OAAOC,GAAP,MAAgB,QAAhB;AACA,SAASC,eAAT,EAA0BC,QAA1B,QAA0C,KAA1C;AACA,eAAeD,eAAe,CAAC;EAC7BE,KAAK,GAAG;IACN,MAAMC,SAAQ,GAAIF,QAAQ,CAAC;MACzBG,QAAQ,EAAE,EADe;MAEzBC,QAAQ,EAAE,EAFe;MAGzBC,QAAQ,EAAE;IAHe,CAAD,CAA1B;;IAMA,IAAIC,YAAW,GAAI,OAAOC,KAAP,EAAcC,KAAd,KAAwB;MACzC,IAAIA,KAAI,KAAM,EAAd,EAAkB;QAChB,OAAOC,OAAO,CAACC,MAAR,CAAe,YAAf,CAAP;MACF,CAFA,MAGK,IAAIF,KAAK,CAACG,MAAN,IAAgBH,KAAK,CAACI,KAAN,CAAY,GAAZ,EAAiBC,IAAjB,CAAsB,EAAtB,EAA0BF,MAA9C,EAAsD;QACzD,OAAOF,OAAO,CAACC,MAAR,CAAe,QAAf,CAAP;MACF,CAFK,MAGA;QACH,OAAOD,OAAO,CAACK,OAAR,EAAP;MACF;IACD,CAVD;;IAYA,IAAIC,YAAW,GAAI,OAAOR,KAAP,EAAcC,KAAd,KAAwB;MACzC,IAAIA,KAAI,KAAM,EAAd,EAAkB;QAChB,OAAOC,OAAO,CAACC,MAAR,CAAe,SAAf,CAAP;MACF,CAFA,MAGK,IAAIF,KAAK,CAACG,MAAN,IAAgBH,KAAK,CAACI,KAAN,CAAY,GAAZ,EAAiBC,IAAjB,CAAsB,EAAtB,EAA0BF,MAA9C,EAAsD;QACzD,OAAOF,OAAO,CAACC,MAAR,CAAe,QAAf,CAAP;MACF,CAFK,MAGA;QACH,OAAOD,OAAO,CAACK,OAAR,EAAP;MACF;IACD,CAVD;;IAYA,MAAME,KAAI,GAAI;MACZZ,QAAQ,EAAE,CAAC;QACTa,QAAQ,EAAE,IADD;QAETC,SAAS,EAAEH,YAFF;QAGTI,OAAO,EAAE;MAHA,CAAD,CADE;MAMZhB,QAAQ,EAAE,CAAC;QACTe,SAAS,EAAEZ,YADF;QAETa,OAAO,EAAE;MAFA,CAAD;IANE,CAAd;;IAYA,MAAMC,QAAO,GAAIC,MAAK,IAAK;MACzBC,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,MAAxB;IACD,CAFD;;IAIA,MAAMG,cAAa,GAAIC,SAAQ,IAAK;MAClCH,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBE,SAAvB;IACD,CAFD;;IAIA,OAAO;MACLT,KADK;MAELd,SAFK;MAGLkB,QAHK;MAILI;IAJK,CAAP;EAMD,CA1D4B;;EA2D7BE,OAAO,GAAG;IACR,IAAIC,MAAK,GAAIC,OAAO,CAAC,WAAD,CAAP,CAAqBD,MAAlC;;IACA,IAAIxB,QAAO,GAAI0B,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAf;;IACA,IAAI3B,QAAJ,EAAc;MACZ,KAAKD,SAAL,CAAeC,QAAf,GAA0B0B,YAAY,CAACC,OAAb,CAAqB,MAArB,CAA1B;MACA,KAAK5B,SAAL,CAAeE,QAAf,GAA0BuB,MAAM,CAACI,MAAP,CAAcF,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAd,CAA1B,CAFY,CAE8D;;MAC1E,KAAK5B,SAAL,CAAeG,QAAf,GAA0B,IAA1B;IACF;EACD,CAnE4B;;EAoE7B2B,OAAO,GAAG;IACRV,OAAO,CAACC,GAAR,CAAY,KAAKU,MAAL,CAAYC,MAAxB;EACD,CAtE4B;;EAwE7BC,OAAO,EAAE;IACP;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEAC,KAAK,GAAG;MACN;MACA,IAAI,KAAKlC,SAAL,CAAeC,QAAf,KAA4B,EAA5B,IAAkC,KAAKD,SAAL,CAAeE,QAAf,IAA2B,EAA7D,IAAmE,KAAKF,SAAL,CAAeC,QAAf,CAAwBQ,MAAxB,KAAmC,KAAKT,SAAL,CAAeC,QAAf,CAAwBS,KAAxB,CAA8B,GAA9B,EAAmCC,IAAnC,CAAwC,EAAxC,EAA4CF,MAAlJ,IACC,KAAKT,SAAL,CAAeE,QAAf,CAAwBO,MAAxB,KAAmC,KAAKT,SAAL,CAAeE,QAAf,CAAwBQ,KAAxB,CAA8B,GAA9B,EAAmCC,IAAnC,CAAwC,EAAxC,EAA4CF,MADpF,EAC4F;QAC1Fd,OAAO,CAACwC,OAAR;QACAxC,OAAO,CAACyC,KAAR,CAAc,cAAd,EAA8B,CAA9B;MACF,CAJA,MAKK;QACH,IAAIC,SAAQ,GAAIzC,GAAG,CAAC,KAAKI,SAAL,CAAeE,QAAhB,CAAnB;QACA,KAAKoC,KAAL,CAAWC,IAAX,CAAgB,gCAAhB,EAAkD;UAChDC,IAAI,EAAE,KAAKxC,SAAL,CAAeC,QAD2B;UAEhDC,QAAQ,EAAEmC;QAFsC,CAAlD,EAGGI,IAHH,CAGSC,QAAD,IAAc;UACpB,IAAIA,QAAQ,CAACC,IAAT,CAAcC,MAAd,KAAyB,SAA7B,EAAwC;YACtCC,cAAc,CAACC,OAAf,CAAuB,MAAvB,EAA+B,KAAK9C,SAAL,CAAeC,QAA9C;YACA4C,cAAc,CAACC,OAAf,CAAuB,MAAvB,EAA+BT,SAA/B;YACAQ,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCJ,QAAQ,CAACC,IAAT,CAAcI,KAA9C;YACAF,cAAc,CAACC,OAAf,CAAuB,KAAvB,EAA8BJ,QAAQ,CAACC,IAAT,CAAcK,GAA5C,EAJsC,CAKtC;;YAEA,IAAI,KAAKhD,SAAL,CAAeG,QAAnB,EAA6B;cAC3B,IAAIsB,MAAK,GAAIC,OAAO,CAAC,WAAD,CAAP,CAAqBD,MAAlC;;cACA,IAAIvB,QAAO,GAAIuB,MAAM,CAACwB,MAAP,CAAc,KAAKjD,SAAL,CAAeE,QAA7B,CAAf,CAF2B,CAE4B;;cACvDyB,YAAY,CAACmB,OAAb,CAAqB,MAArB,EAA6B,KAAK9C,SAAL,CAAeC,QAA5C;cACA0B,YAAY,CAACmB,OAAb,CAAqB,UAArB,EAAiC5C,QAAjC;YACF,CALA,MAMK;cACHyB,YAAY,CAACuB,UAAb,CAAwB,MAAxB;cACAvB,YAAY,CAACuB,UAAb,CAAwB,UAAxB;YACF;;YAEAvD,OAAO,CAACwC,OAAR;YACAxC,OAAO,CAACwD,OAAR,CAAgB,MAAhB,EAAwB,CAAxB;YACA,KAAKC,OAAL,CAAaC,IAAb,CAAkB,WAAlB;UACF;;UAEA,IAAIX,QAAQ,CAACC,IAAT,CAAcC,MAAd,KAAyB,MAA7B,EAAqC;YACnCjD,OAAO,CAACwC,OAAR;YACAxC,OAAO,CAAC2D,OAAR,CAAgB,YAAhB,EAA8B,CAA9B;UACF;;UACA,IAAIZ,QAAQ,CAACC,IAAT,CAAcC,MAAd,KAAyB,MAA7B,EAAqC;YACnCjD,OAAO,CAACwC,OAAR;YACAxC,OAAO,CAACyC,KAAR,CAAc,WAAd,EAA2B,CAA3B;UACF;;UACA,IAAIM,QAAQ,CAACC,IAAT,CAAcC,MAAd,KAAyB,OAA7B,EAAsC;YACpCjD,OAAO,CAACwC,OAAR;YACAxC,OAAO,CAAC2D,OAAR,CAAgB,MAAhB,EAAwB,CAAxB;UACF;QAED,CAxCD,EAwCGC,KAxCH,CAwCS,UAAUnB,KAAV,EAAiB;UAAE;UAC1BhB,OAAO,CAACC,GAAR,CAAYe,KAAZ;QACD,CA1CD;MA2CF;IACD;;EApEM;AAxEoB,CAAD,CAA9B","names":["message","md5","defineComponent","reactive","setup","formState","username","password","remember","validateName","_rule","value","Promise","reject","length","split","join","resolve","validatePass","rules","required","validator","trigger","onFinish","values","console","log","onFinishFailed","errorInfo","mounted","Base64","require","localStorage","getItem","decode","created","$route","params","methods","login","destroy","error","pass_word","$http","post","name","then","response","data","result","sessionStorage","setItem","token","uid","encode","removeItem","success","$router","push","warning","catch"],"sourceRoot":"","sources":["/home/ubuntu/community/vue-web/src/views/user/LoginUser.vue"],"sourcesContent":["<template>\r\n\r\n  <div>\r\n\r\n    <!--\t\t Sign Up Image And Headings-->\r\n    <div class=\"sign-up-header\" style=\"background-color: #3EA1EC\">\r\n      <div class=\"content\">\r\n        <h2 class=\"mb-5\" style=\"font-size: 42px\">AnonyVote</h2>\r\n        <p class=\"text-lg\">携手共建智慧家园</p>\r\n      </div>\r\n    </div>\r\n    <!--\t\t / Sign Up Image And Headings-->\r\n\r\n    <!-- Sign Up Form -->\r\n    <a-card :bordered=\"false\" class=\"card-signup header-solid h-full\" :bodyStyle=\"{ paddingTop: 0 }\">\r\n      <template #title>\r\n        <h5 class=\"font-semibold text-center\">账户登录</h5>\r\n      </template>\r\n\r\n      <a-form id=\"components-form-demo-normal-login\" :rules=\"rules\" :model=\"formState\" name=\"basic\" class=\"login-form\"\r\n        autocomplete=\"off\">\r\n\r\n        <a-form-item has-feedback name=\"username\">\r\n          <a-input type=\"text\" placeholder=\"账户\" v-model:value=\"formState.username\" autocomplete=\"off\">\r\n            <template #prefix>\r\n              <user-outlined style=\"color: rgba(0, 0, 0, 0.45)\" type=\"user\" />\r\n            </template>\r\n            <template #suffix>\r\n              <a-tooltip title=\"这是必要信息\">\r\n                <info-circle-outlined style=\"color: rgba(0, 0, 0, 0.45)\" />\r\n              </a-tooltip>\r\n            </template>\r\n          </a-input>\r\n        </a-form-item>\r\n\r\n        <a-form-item has-feedback name=\"password\">\r\n          <a-input-password type=\"text\" placeholder=\"密码\" v-model:value=\"formState.password\" autocomplete=\"off\" />\r\n        </a-form-item>\r\n\r\n        <a-form-item>\r\n          <a-checkbox style=\"color: rgba(0, 0, 0, 0.45)\" v-model:checked=\"formState.remember\">记住密码</a-checkbox>\r\n          <router-link class=\"register\" to='/register' style=\"float: right;\">注册账户</router-link>\r\n        </a-form-item>\r\n\r\n        <a-form-item>\r\n\r\n          <a-button style=\"width:100%;font-size: 15px;\" type=\"primary\" html-type=\"submit\" @click=\"login\">登录</a-button>\r\n        </a-form-item>\r\n      </a-form>\r\n\r\n      <!-- <p class=\"font-semibold text-muted text-center\">已有账户 <router-link to=\"/login\" class=\"font-bold text-dark\">登录</router-link></p> -->\r\n    </a-card>\r\n\r\n  </div>\r\n</template>\r\n<script>\r\n\r\nimport { message } from 'ant-design-vue';\r\nimport md5 from 'js-md5';\r\nimport { defineComponent, reactive } from 'vue';\r\nexport default defineComponent({\r\n  setup() {\r\n    const formState = reactive({\r\n      username: '',\r\n      password: '',\r\n      remember: false\r\n    });\r\n\r\n    let validateName = async (_rule, value) => {\r\n      if (value === '') {\r\n        return Promise.reject('请输入正确格式账户名');\r\n      }\r\n      else if (value.length != value.split(\" \").join(\"\").length) {\r\n        return Promise.reject('输入包含空格');\r\n      }\r\n      else {\r\n        return Promise.resolve();\r\n      }\r\n    };\r\n\r\n    let validatePass = async (_rule, value) => {\r\n      if (value === '') {\r\n        return Promise.reject('请输入初始密码');\r\n      }\r\n      else if (value.length != value.split(\" \").join(\"\").length) {\r\n        return Promise.reject('输入包含空格');\r\n      }\r\n      else {\r\n        return Promise.resolve();\r\n      }\r\n    };\r\n\r\n    const rules = {\r\n      password: [{\r\n        required: true,\r\n        validator: validatePass,\r\n        trigger: 'change',\r\n      }],\r\n      username: [{\r\n        validator: validateName,\r\n        trigger: 'change',\r\n      }],\r\n    };\r\n\r\n    const onFinish = values => {\r\n      console.log('Success:', values);\r\n    };\r\n\r\n    const onFinishFailed = errorInfo => {\r\n      console.log('Failed:', errorInfo);\r\n    };\r\n\r\n    return {\r\n      rules,\r\n      formState,\r\n      onFinish,\r\n      onFinishFailed,\r\n    };\r\n  },\r\n  mounted() {\r\n    let Base64 = require('js-base64').Base64\r\n    let username = localStorage.getItem(\"user\");\r\n    if (username) {\r\n      this.formState.username = localStorage.getItem(\"user\");\r\n      this.formState.password = Base64.decode(localStorage.getItem(\"password\"));// base64解密\r\n      this.formState.remember = true;\r\n    }\r\n  },\r\n  created() {\r\n    console.log(this.$route.params);\r\n  },\r\n\r\n  methods: {\r\n    // str2hex(str) {\r\n    //   if (str === \"\") {\r\n    //     return \"\";\r\n    //   }\r\n    //   else {\r\n    //     var arr = [];\r\n    //     //arr.push(\"0x\");\r\n    //     for (var i = 0; i < str.length; i++) {\r\n    //       arr.push(str.charCodeAt(i).toString(16));\r\n    //     }\r\n    //     return arr.join('');\r\n    //   }\r\n    // },\r\n\r\n    login() {\r\n      // console.log(\"dddddd\",this.str2hex(\"ddd\"))\r\n      if (this.formState.username === '' || this.formState.password == '' || this.formState.username.length !== this.formState.username.split(\" \").join(\"\").length\r\n        || this.formState.password.length !== this.formState.password.split(\" \").join(\"\").length) {\r\n        message.destroy()\r\n        message.error('登录错误，请检查输入格式', 3)\r\n      }\r\n      else {\r\n        var pass_word = md5(this.formState.password)\r\n        this.$http.post('http://192.168.5.42:9999/login', {\r\n          name: this.formState.username,\r\n          password: pass_word\r\n        }).then((response) => {\r\n          if (response.data.result === 'success') {\r\n            sessionStorage.setItem('user', this.formState.username)\r\n            sessionStorage.setItem('pass', pass_word)\r\n            sessionStorage.setItem('token', response.data.token)\r\n            sessionStorage.setItem('uid', response.data.uid)\r\n            // sessionStorage.setItem('uid', 'aa')\r\n\r\n            if (this.formState.remember) {\r\n              let Base64 = require('js-base64').Base64\r\n              let password = Base64.encode(this.formState.password); // base64加密\r\n              localStorage.setItem(\"user\", this.formState.username);\r\n              localStorage.setItem(\"password\", password);\r\n            }\r\n            else {\r\n              localStorage.removeItem(\"user\");\r\n              localStorage.removeItem(\"password\");\r\n            }\r\n\r\n            message.destroy()\r\n            message.success('登录成功', 3)\r\n            this.$router.push('/overview')\r\n          }\r\n\r\n          if (response.data.result === 'none') {\r\n            message.destroy()\r\n            message.warning('用户名不存在，请注册', 3)\r\n          }\r\n          if (response.data.result === 'fail') {\r\n            message.destroy()\r\n            message.error('登录失败，密码错误', 3)\r\n          }\r\n          if (response.data.result === 'error') {\r\n            message.destroy()\r\n            message.warning('登录出错', 3)\r\n          }\r\n\r\n        }).catch(function (error) { // 请求失败处理\r\n          console.log(error)\r\n        })\r\n      }\r\n    },\r\n  }\r\n\r\n});\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.user-layout-login {\r\n  label {\r\n    font-size: 14px;\r\n  }\r\n\r\n  .getCaptcha {\r\n    display: block;\r\n    width: 100%;\r\n    height: 40px;\r\n  }\r\n\r\n  .forge-password {\r\n    font-size: 14px;\r\n  }\r\n\r\n  button.login-button {\r\n    padding: 0 15px;\r\n    font-size: 16px;\r\n    height: 40px;\r\n    width: 100%;\r\n  }\r\n\r\n  .user-login-other {\r\n    text-align: left;\r\n    margin-top: 24px;\r\n    line-height: 22px;\r\n\r\n    .item-icon {\r\n      font-size: 24px;\r\n      color: rgba(0, 0, 0, 0.2);\r\n      margin-left: 16px;\r\n      vertical-align: middle;\r\n      cursor: pointer;\r\n      transition: color 0.3s;\r\n\r\n      &:hover {\r\n        color: #1890ff;\r\n      }\r\n    }\r\n\r\n    .register {\r\n      float: right;\r\n    }\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}