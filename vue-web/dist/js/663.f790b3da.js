"use strict";(self["webpackChunkvue_web"]=self["webpackChunkvue_web"]||[]).push([[663,478],{1663:function(e,t,a){a.r(t),a.d(t,{default:function(){return O}});var r=a(3396),s=a(9242);const l={class:"content"};function o(e,t,a,o,n,d){const i=(0,r.up)("StepTwo"),u=(0,r.up)("StepThree"),m=(0,r.up)("StepFour"),p=(0,r.up)("a-card");return(0,r.wg)(),(0,r.j4)(p,{bordered:!1},{default:(0,r.w5)((()=>[(0,r._)("div",l,[(0,r.wy)((0,r.Wm)(i,{onNextStep:d.nextStep,onPrevStep:d.prevStep},null,8,["onNextStep","onPrevStep"]),[[s.F8,1===n.currentTab]]),(0,r.wy)((0,r.Wm)(u,{onFinish:d.finish},null,8,["onFinish"]),[[s.F8,2===n.currentTab]]),(0,r.wy)((0,r.Wm)(m,{onFinish:d.finish},null,8,["onFinish"]),[[s.F8,3===n.currentTab]])])])),_:1})}var n=a(7139);const d=e=>((0,r.dD)("data-v-50880634"),e=e(),(0,r.Cn)(),e),i={style:{margin:"3px auto 0"}},u=d((()=>(0,r._)("h5",{style:{"text-align":"center",margin:"20px"}},"权重投票活动链上选票信息",-1))),m=(0,r.Uk)("选票信息"),p=(0,r.Uk)(" 本地生成秘密份额 "),c=(0,r.Uk)("上一步"),f=(0,r.Uk)("上传份额"),h=d((()=>(0,r._)("div",{class:"step-form-style-desc"},[(0,r._)("h3",null,"说明"),(0,r._)("h4",null,"加入匿名权重投票事项：请根据以上项目ID返回投票信息完成投票表决。")],-1)));function w(e,t,a,s,l,o){const d=(0,r.up)("a-descriptions-item"),w=(0,r.up)("a-descriptions"),g=(0,r.up)("a-tooltip"),S=(0,r.up)("a-table"),W=(0,r.up)("a-form-item"),C=(0,r.up)("upload-outlined"),b=(0,r.up)("a-button"),x=(0,r.up)("a-upload"),y=(0,r.up)("a-divider"),k=(0,r.up)("a-form");return(0,r.wg)(),(0,r.iD)("div",i,[(0,r.Wm)(k,{model:e.formStateWe,name:"custom-validation",rules:e.rules,labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,r.w5)((()=>[u,(0,r.Wm)(W,{label:"投票信息",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"投票地址"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.formStateWe.addr),1)])),_:1})])),_:1}),""!=e.formStateWe.data?((0,r.wg)(),(0,r.j4)(S,{key:0,columns:e.columns,"data-source":e.formStateWe.data,pagination:e.mypagination,size:"large",bordered:""},{bodyCell:(0,r.w5)((({column:e,text:t})=>["name"===e.dataIndex?((0,r.wg)(),(0,r.j4)(g,{key:0},{title:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(t),1)])),default:(0,r.w5)((()=>[(0,r.Uk)(" "+(0,n.zw)(t),1)])),_:2},1024)):(0,r.kq)("",!0)])),title:(0,r.w5)((()=>[m])),_:1},8,["columns","data-source","pagination"])):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(W,{label:"加密选票","has-feedback":"",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{showUploadList:!1,beforeUpload:e.beforeUpload1,accept:".txt",name:"file"},{default:(0,r.w5)((()=>[(0,r.Wm)(b,{size:"large","html-type":"submit"},{default:(0,r.w5)((()=>[(0,r.Wm)(C),p])),_:1})])),_:1},8,["beforeUpload"]),(0,r.Wm)(w,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"计票中间值C1"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.formStateWe.C1),1)])),_:1}),(0,r.Wm)(d,{label:"计票中间值C2"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.formStateWe.C2),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(W,{label:"秘密份额",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"权重活动秘密份额"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.formStateWe.share),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(W,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Wm)(b,{type:"primary",onClick:e.prevStep},{default:(0,r.w5)((()=>[c])),_:1},8,["onClick"]),(0,r.Wm)(b,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:e.nextStepWe},{default:(0,r.w5)((()=>[f])),_:1},8,["onClick"])])),_:1}),(0,r.Wm)(y),h])),_:1},8,["model","rules"])])}var g=a(333),S=a(252),W=a(4870);const C=[{title:"ID",dataIndex:"0",ellipsis:!0},{title:"签名公钥",dataIndex:"1",ellipsis:!0},{title:"权重",dataIndex:"2"},{title:"选票",dataIndex:"3",ellipsis:!0},{title:"签名",dataIndex:"4",ellipsis:!0}];var b=(0,r.aZ)({inject:["reload"],setup(){const e=(0,W.qj)({addr:"",vote:!1,share:"",C1:"",C2:"",data:[]});let t=async(e,t)=>""===t?Promise.reject("请根据要求操作"):Promise.resolve();const a={signature:[{required:!0,validator:t,trigger:"change"}]};return{rules:a,validateSignature:t,formStateWe:e,columns:C,mypagination:{defaultPageSize:3}}},created(){console.log("chancan",this.$route.params.info),this.weresult(this.$route.params.info)},methods:{weresult(e){e=JSON.parse(e),"success"==e.result?(g.Z.emit("resballot",e),this.$emit("next3Step")):(this.formStateWe.addr=e.addr,this.formStateWe.data=e.ballot)},beforeUpload1(e){return this.read1(e),!1},read1(e){const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=e=>{const t=e.target.result;var a=JSON.parse(t),r=this.formStateWe.addr.indexOf(a.addr);if(console.log("indexshism",r),-1==r)S.ZP.destroy(),S.ZP.warning("文件上传错误，不是当前投票活动参数");else{var s=new Object;s.P=a.P,s.Q=a.Q,s.G=a.G;var l=this.formStateWe.data,o=this.formStateWe.data.length,n=new Array(o),d=new Array(o),i=new Array(o),u=new Array(o);for(let e=0;e<o;e++)console.log(l[e][1]),n[e]=JSON.parse(l[e][3]),d[e]=JSON.stringify(n[e]),i[e]=JSON.parse(l[e][4]),u[e]=JSON.parse(l[e][1]);var m=count(s,n,i,u,d,o);console.log("CCCCCCCCCC",m),console.log("CCCCCCCCCC",u),this.formStateWe.share=decrypt0(s,m.C1,a.sk),this.formStateWe.C1=m.C1,this.formStateWe.C2=m.C2}}},prevStep(){this.$router.push("/result")},nextStepWe(){console.log(this.formStateWe.share),""==this.formStateWe.share&&(S.ZP.destroy(),S.ZP.warning("请点击并上传本地加密信息文件")),this.addshare()},addshare(){this.$http.post("http://192.168.5.42:8888/voterwe/upload_share",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),uid:sessionStorage.getItem("uid"),share:this.formStateWe.share,C1:this.formStateWe.C1,C2:this.formStateWe.C2,addr:this.formStateWe.addr}).then((e=>{console.log(e),"success"==e.data.result&&this.$emit("nextStep"),"error1"==e.data.result&&(S.ZP.destroy(),S.ZP.warning("请检查登录")),"error2"==e.data.result&&(S.ZP.destroy(),S.ZP.warning("上链失败！")),"error3"==e.data.result&&g.Z.emit("change",e.data)}))}}}),x=a(89);const y=(0,x.Z)(b,[["render",w],["__scopeId","data-v-50880634"]]);var k=y;const _={style:{margin:"40px auto 0"}},v=(0,r.Uk)(" 请等待其他投票参与方共同恢复计票结果，请及时关注获取投票结果。 "),U=(0,r.Uk)("获取结果");function P(e,t,a,s,l,o){const n=(0,r.up)("a-button"),d=(0,r.up)("a-result");return(0,r.wg)(),(0,r.iD)("div",_,[(0,r.Wm)(d,{status:"success",title:"您已经成功上传该投票活动的解密份额",model:e.formState},{subTitle:(0,r.w5)((()=>[v])),extra:(0,r.w5)((()=>[(0,r.Wm)(n,{key:"buy",onClick:e.result},{default:(0,r.w5)((()=>[U])),_:1},8,["onClick"])])),_:1},8,["model"])])}var I=(0,r.aZ)({inject:["reload"],methods:{result(){this.$router.push("/result")}}});const Z=(0,x.Z)(I,[["render",P]]);var j=Z,T=a(5478),z={name:"StepForm",components:{StepTwo:k,StepThree:j,StepFour:T["default"]},data(){return{currentTab:1,form:null,title:""}},methods:{nextStep(){this.currentTab<3&&(this.currentTab+=1)},next3Step(){this.currentTab<3&&(this.currentTab+=3)},prevStep(){this.currentTab>0&&(this.currentTab-=1)},finish(){this.currentTab=0}}};const q=(0,x.Z)(z,[["render",o],["__scopeId","data-v-6bb57994"]]);var O=q},5478:function(e,t,a){a.r(t),a.d(t,{default:function(){return W}});var r=a(3396),s=a(7139);const l=e=>((0,r.dD)("data-v-785b9238"),e=e(),(0,r.Cn)(),e),o={style:{margin:"3px auto 0"}},n=l((()=>(0,r._)("h5",{style:{"text-align":"center",margin:"20px"}},"权重投票活动链上选票信息汇总",-1))),d=(0,r.Uk)("选票信息"),i=(0,r.Uk)("上一步"),u=(0,r.Uk)("获取结果"),m=l((()=>(0,r._)("div",{class:"step-form-style-desc"},[(0,r._)("h3",null,"说明"),(0,r._)("h4",null,"加入匿名权重投票事项：请根据以上项目ID返回投票信息完成投票表决。")],-1)));function p(e,t,a,l,p,c){const f=(0,r.up)("a-descriptions-item"),h=(0,r.up)("a-descriptions"),w=(0,r.up)("a-tooltip"),g=(0,r.up)("a-table"),S=(0,r.up)("a-form-item"),W=(0,r.up)("a-spin"),C=(0,r.up)("a-button"),b=(0,r.up)("a-divider"),x=(0,r.up)("a-form"),y=(0,r.up)("a-card");return(0,r.wg)(),(0,r.j4)(y,{bordered:!1},{default:(0,r.w5)((()=>[(0,r._)("div",o,[(0,r.Wm)(x,{model:e.formStateWe,name:"custom-validation",rules:e.rules,labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,r.w5)((()=>[n,(0,r.Wm)(S,{label:"投票信息",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{label:"投票地址"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.addr),1)])),_:1})])),_:1}),""!=e.formStateWe.data?((0,r.wg)(),(0,r.j4)(g,{key:0,columns:e.columns,"data-source":e.formStateWe.data,pagination:e.mypagination,size:"large",bordered:""},{bodyCell:(0,r.w5)((({column:e,text:t})=>["name"===e.dataIndex?((0,r.wg)(),(0,r.j4)(w,{key:0},{title:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t),1)])),default:(0,r.w5)((()=>[(0,r.Uk)(" "+(0,s.zw)(t),1)])),_:2},1024)):(0,r.kq)("",!0)])),title:(0,r.w5)((()=>[d])),_:1},8,["columns","data-source","pagination"])):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(S,{label:"统计结果",rules:[{required:!0}]},{default:(0,r.w5)((()=>[e.formStateWe.sum?((0,r.wg)(),(0,r.j4)(h,{key:0,bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{label:"决议得票"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.sum),1)])),_:1})])),_:1})):(0,r.kq)("",!0),""===e.formStateWe.res&&""!==e.formStateWe.click?((0,r.wg)(),(0,r.j4)(W,{key:1,size:"small"})):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(S,{label:"表决结果",rules:[{required:!0}]},{default:(0,r.w5)((()=>[e.formStateWe.res?((0,r.wg)(),(0,r.j4)(h,{key:0,bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{label:"统计结果"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.res),1)])),_:1})])),_:1})):(0,r.kq)("",!0),""===e.formStateWe.res&&""!==e.formStateWe.click?((0,r.wg)(),(0,r.j4)(W,{key:1,size:"small"})):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(S,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Wm)(C,{type:"primary",onClick:e.prevStep},{default:(0,r.w5)((()=>[i])),_:1},8,["onClick"]),(0,r.Wm)(C,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:e.getres,disabled:""!==e.formStateWe.click},{default:(0,r.w5)((()=>[u])),_:1},8,["onClick","disabled"])])),_:1}),(0,r.Wm)(b),m])),_:1},8,["model","rules"])])])),_:1})}a(333);var c=a(252),f=a(4870);const h=[{title:"ID",dataIndex:"0",ellipsis:!0},{title:"签名公钥",dataIndex:"1",ellipsis:!0},{title:"权重",dataIndex:"2"},{title:"选票",dataIndex:"3",ellipsis:!0},{title:"签名",dataIndex:"4",ellipsis:!0}];var w=(0,r.aZ)({inject:["reload"],setup(){const e=(0,f.qj)({addr:"",res:"",sum:"",data:[],click:""});return{formStateWe:e,columns:h,mypagination:{defaultPageSize:3}}},created(){console.log("chancan",this.$route.params.info),this.prevStep1(this.$route.params.info)},methods:{prevStep1(e){e=JSON.parse(e),this.formStateWe.addr=e.addr,this.formStateWe.data=e.ballot},prevStep(){this.$router.push("/result")},beforeUpload1(e){return this.read1(e),!1},read1(e){const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=e=>{const t=e.target.result;var a=JSON.parse(t),r=this.formStateWe.addr.indexOf(a.addr);if(console.log("indexshism",r),-1==r)c.ZP.destroy(),c.ZP.warning("文件上传错误，不是当前投票活动参数");else{var s=new Object;s.P=a.P,s.Q=a.Q,s.G=a.G;var l=this.formStateWe.data,o=this.formStateWe.data.length,n=new Array(o),d=new Array(o),i=new Array(o),u=new Array(o);for(let e=0;e<o;e++)console.log(l[e][1]),n[e]=JSON.parse(l[e][3]),d[e]=JSON.stringify(n[e]),i[e]=JSON.parse(l[e][4]),u[e]=JSON.parse(l[e][1]);var m=count(s,n,i,u,d,o);console.log("CCCCCCCCCC",m),console.log("CCCCCCCCCC",u),this.formStateWe.share=decrypt0(s,m.C1,a.sk),this.formStateWe.C1=m.C1,this.formStateWe.C2=m.C2}}},getres(){this.formStateWe.click="click",this.$http.post("http://192.168.5.42:8888/voterwe/get_we_result",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),addr:this.formStateWe.addr}).then((e=>{if(console.log(e),"success"==e.data.result){console.log("jieguo:",e.data);var t=new Object;t.P=e.data.para[0],t.Q=e.data.para[1],t.G=e.data.para[2];var a=e.data.C2,r=e.data.Cx,s=r.length,l=100,o=decrypt1(t,a,r,s,l);console.log("b:",o),this.formStateWe.sum=o,o>0&&(this.formStateWe.res="通过"),o<0&&(this.formStateWe.res="未通过"),(o=0)&&(this.formStateWe.res="中立")}"error1"==e.data.result&&(c.ZP.destroy(),c.ZP.warning("请检查登录")),"wait"==e.data.result&&(c.ZP.destroy(),c.ZP.warning("请等候所有的参与者共同恢复结果"))}))}}}),g=a(89);const S=(0,g.Z)(w,[["render",p],["__scopeId","data-v-785b9238"]]);var W=S}}]);
//# sourceMappingURL=663.f790b3da.js.map