"use strict";(self["webpackChunkvue_web"]=self["webpackChunkvue_web"]||[]).push([[986],{4986:function(t,e,a){a.r(e),a.d(e,{default:function(){return q}});var r=a(3396),s=a(7139),o=a(9242);const l={class:"content"};function i(t,e,a,i,n,u){const m=(0,r.up)("a-popover"),d=(0,r.up)("a-step"),p=(0,r.up)("a-steps"),f=(0,r.up)("StepTwo"),c=(0,r.up)("StepThree"),h=(0,r.up)("a-card");return(0,r.wg)(),(0,r.j4)(h,{bordered:!1},{default:(0,r.w5)((()=>[(0,r.Wm)(p,{class:"steps",current:n.currentTab},{progressDot:(0,r.w5)((({index:t,status:e,prefixCls:a})=>[(0,r.Wm)(m,null,{content:(0,r.w5)((()=>[(0,r._)("span",null,"step "+(0,s.zw)(t)+" status: "+(0,s.zw)(e),1)])),default:(0,r.w5)((()=>[(0,r._)("span",{class:(0,s.C_)(`${a}-icon-dot`)},null,2)])),_:2},1024)])),default:(0,r.w5)((()=>[(0,r.Wm)(d,{title:"投票项目ID"}),(0,r.Wm)(d,{title:"加密选票并上链"}),(0,r.Wm)(d,{title:"完成"})])),_:1},8,["current"]),(0,r._)("div",l,[(0,r.wy)((0,r.Wm)(f,{onNextStep:u.nextStep,onPrevStep:u.prevStep},null,8,["onNextStep","onPrevStep"]),[[o.F8,1===n.currentTab]]),(0,r.wy)((0,r.Wm)(c,{onFinish:u.finish},null,8,["onFinish"]),[[o.F8,2===n.currentTab]])])])),_:1})}const n=t=>((0,r.dD)("data-v-251a296b"),t=t(),(0,r.Cn)(),t),u={style:{margin:"3px auto 0"}},m=n((()=>(0,r._)("h5",{style:{"text-align":"center","margin-top":"20px"}},"匿名灵活投票活动信息",-1))),d=(0,r.Uk)(" 本地读取加密信息并生成选票 "),p=(0,r.Uk)("上一步"),f=(0,r.Uk)("下一步"),c=n((()=>(0,r._)("div",{class:"step-form-style-desc"},[(0,r._)("h3",null,"说明"),(0,r._)("h4",null,"加入匿名灵活投票事项：请根据以上项目ID返回投票信息完成投票。"),(0,r._)("p")],-1)));function h(t,e,a,o,l,i){const n=(0,r.up)("a-descriptions-item"),h=(0,r.up)("a-descriptions"),S=(0,r.up)("a-form-item"),w=(0,r.up)("a-radio"),g=(0,r.up)("a-radio-group"),b=(0,r.up)("a-checkbox"),v=(0,r.up)("a-row"),k=(0,r.up)("a-checkbox-group"),_=(0,r.up)("a-rate"),y=(0,r.up)("upload-outlined"),x=(0,r.up)("a-button"),P=(0,r.up)("a-upload"),W=(0,r.up)("a-divider"),U=(0,r.up)("a-form");return(0,r.wg)(),(0,r.iD)("div",u,[(0,r.Wm)(U,{model:t.formState,name:"custom-validation",rules:t.rules,labelCol:{lg:{span:8},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,r.w5)((()=>[m,(0,r.Wm)(S,{label:"投票信息"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"投票地址"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.addr),1)])),_:1}),(0,r.Wm)(n,{label:"投票标题"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.title),1)])),_:1}),(0,r.Wm)(n,{label:"投票截止时间"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.endTime),1)])),_:1})])),_:1}),(0,r.Wm)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1},style:{"margin-top":"20px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"构建的加密公钥"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.PK),1)])),_:1}),(0,r.Wm)(n,{label:"构建的加密公钥列表"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.PKlist),1)])),_:1})])),_:1})])),_:1}),"单选"==t.formState.type?((0,r.wg)(),(0,r.j4)(S,{key:0,label:"投票选项",name:"pattern",rules:[{required:!0,message:"请选择投票选项"}]},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{size:"large",value:t.formState["pattern"],"onUpdate:value":e[0]||(e[0]=e=>t.formState["pattern"]=e),style:{width:"100%"}},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.formState.choices,(t=>((0,r.wg)(),(0,r.j4)(w,{span:8,key:t.key,value:t},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})):(0,r.kq)("",!0),"多选"==t.formState.type?((0,r.wg)(),(0,r.j4)(S,{key:1,label:"投票选项",name:"result",rules:[{required:!0,message:"请选择投票选项"}]},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{size:"large",value:t.formState.result,"onUpdate:value":e[1]||(e[1]=e=>t.formState.result=e),style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.formState.choices,((t,e)=>((0,r.wg)(),(0,r.j4)(b,{key:e,value:t},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t),1)])),_:2},1032,["value"])))),128))])),_:1})])),_:1},8,["value"])])),_:1})):(0,r.kq)("",!0),"分数"==t.formState.type?((0,r.wg)(!0),(0,r.iD)(r.HY,{key:2},(0,r.Ko)(t.formState.score,((t,e)=>((0,r.wg)(),(0,r.j4)(S,{label:"投票选项",name:"score",rules:[{required:!0,message:"请选择投票选项"}],key:t.key},{default:(0,r.w5)((()=>[(0,r.Wm)(n,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.item)+" ",1),(0,r.Wm)(_,{value:t.value,"onUpdate:value":e=>t.value=e},null,8,["value","onUpdate:value"])])),_:2},1024)])),_:2},1024)))),128)):(0,r.kq)("",!0),(0,r.Wm)(S,{label:"加密选票","has-feedback":""},{default:(0,r.w5)((()=>[(0,r.Wm)(P,{showUploadList:!1,beforeUpload:t.beforeUpload,accept:".txt",name:"file"},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{size:"large","html-type":"submit"},{default:(0,r.w5)((()=>[(0,r.Wm)(y),d])),_:1})])),_:1},8,["beforeUpload"])])),_:1}),(0,r.Wm)(S,{label:"选票信息"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1},style:{"margin-top":"20px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"选票加密"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.rawballot),1)])),_:1}),(0,r.Wm)(n,{label:"选票签名"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.formState.signature),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(S,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{type:"primary",onClick:t.prevStep},{default:(0,r.w5)((()=>[p])),_:1},8,["onClick"]),(0,r.Wm)(x,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:t.nextStep},{default:(0,r.w5)((()=>[f])),_:1},8,["onClick"])])),_:1}),(0,r.Wm)(W),c])),_:1},8,["model","rules"])])}var S=a(333),w=a(252),g=a(4870),b=(0,r.aZ)({inject:["reload"],setup(){const t=(0,g.qj)({addr:"",title:"",endTime:"",PKlist:[],PK:"",rawballot:"",signature:"",choices:[],type:"",result:[],score:[],n:"",k:"",allrpub:[],m:""});let e=async(t,e)=>""===e?Promise.reject("请输入正确格式账户名"):e.length!=e.split(" ").join("").length?Promise.reject("输入包含空格"):Promise.resolve();const a={signature:[{required:!0,validator:e,trigger:"change"}]};return{formState:t,rules:a,validateSignature:e}},created(){console.log("chancan",this.$route.params.info),this.avcinfo(this.$route.params.info)},methods:{avcinfo(t){var e;for(e in t=JSON.parse(t),this.formState.addr=t.addr,this.formState.title=t.voteinfo[0],this.formState.type=t.voteinfo[2],this.formState.endTime=t.voteinfo[1],this.formState.PKlist=t.PKlist,this.formState.PK=t.PK,this.formState.choices=t.choice,this.formState.n=t.para[3],this.formState.k=t.para[4],this.formState.allrpub=t.rpub,this.formState.choices)this.formState.score.push({value:0,item:this.formState.choices[e],key:Date.now()})},prevStep(){this.$router.push("/voting")},str2hex(t){if(""===t)return"";for(var e=[],a=0;a<t.length;a++)e.push(t.charCodeAt(a).toString(16));return e.join("")},beforeUpload(t){return this.read(t),!1},read(t){const e=new FileReader;e.readAsText(t,"UTF-8"),e.onload=t=>{const e=t.target.result;var a=JSON.parse(e),r=this.formState.addr.indexOf(a.addr);if(console.log("indexshism",r),-1==r)w.ZP.destroy(),w.ZP.warning("文件上传错误，不是当前投票活动参数");else{var s=new Object;if(s.P=a.P,s.Q=a.Q,s.G=a.G,""==this.formState.PK){var o=generatepub(s,this.formState.PKlist,this.formState.PKlist.length);console.log("系统公钥建立：",o),this.formState.PK=o,this.setPK()}"单选"==this.formState.type&&(this.formState.m=this.formState["pattern"]),"多选"==this.formState.type&&(this.formState.m=this.formState.result),"分数"==this.formState.type&&(this.formState.m=this.formState.score.map((t=>t.value)).toString()),console.log("ssssss",this.formState.m),this.formState.rawballot=JSON.stringify(encrypt1(s,this.formState.n,this.formState.k,this.formState.PK,this.str2hex(this.formState.m),this.formState.PK,this.formState.PKlist)),console.log("m:",this.str2hex(this.formState.m));var l=this.formState.allrpub.indexOf(a.ring_pk);console.log("ssssss",l),console.log("ssssss",this.formState.allrpub),this.formState.signature=sign1(a.ring_sk,this.formState.allrpub,this.formState.rawballot,l,this.formState.n),console.log("选票和签名",this.formState.rawballot,this.formState.signature)}}},setPK(){this.$http.post("http://192.168.5.42:8888/voteravc/upload_avcPK",{PK:this.formState.PK,addr:this.formState.addr}).then((t=>{console.log(t)}))},nextStep(){console.log(this.formState.score),this.formState.m&&(""==this.formState.signature&&(w.ZP.destroy(),w.ZP.warning("请点击并上传本地加密信息文件")),this.addavcballot())},addavcballot(){this.$http.post("http://192.168.5.42:8888/voteravc/add_avc_ballot",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),uid:sessionStorage.getItem("uid"),ballotstr:this.formState.rawballot,signature:this.formState.signature,addr:this.formState.addr,PK:this.formState.PK}).then((t=>{console.log(t),"success"==t.data.result&&(S.Z.emit("change1",t.data),this.$emit("nextStep")),"error1"==t.data.result&&(w.ZP.destroy(),w.ZP.warning("请检查登录")),"error2"==t.data.result&&(w.ZP.destroy(),w.ZP.warning("没有找到对应投票项目")),"error3"==t.data.result&&S.Z.emit("change",t.data)}))}}}),v=a(89);const k=(0,v.Z)(b,[["render",h],["__scopeId","data-v-251a296b"]]);var _=k;const y={style:{margin:"40px auto 0"}},x=(0,r.Uk)(" 该投票项目的合约地址:"),P=(0,r.Uk)("查看详情"),W=(0,r.Uk)(" 查询更多投票信息，请及时点击获取结果！ "),U=(0,r.Uk)("查看详情");function K(t,e,a,o,l,i){const n=(0,r.up)("a-typography-title"),u=(0,r.up)("a-button"),m=(0,r.up)("a-result");return(0,r.wg)(),(0,r.iD)("div",y,[t.success?((0,r.wg)(),(0,r.j4)(m,{key:0,status:"success",title:"您的选票已成功上链，请及时点击获取投票结果！",model:t.formState},{subTitle:(0,r.w5)((()=>[x,(0,r.Wm)(n,{level:4},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.addr),1)])),_:1})])),extra:(0,r.w5)((()=>[(0,r.Wm)(u,{key:"buy",onClick:t.reslut},{default:(0,r.w5)((()=>[P])),_:1},8,["onClick"])])),_:1},8,["model"])):(0,r.kq)("",!0),t.fail?((0,r.wg)(),(0,r.j4)(m,{key:1,status:"error",title:"该投票项目已经超时，您的选票上链失败",model:t.formState},{subTitle:(0,r.w5)((()=>[W])),extra:(0,r.w5)((()=>[(0,r.Wm)(u,{key:"buy",onClick:t.reslut},{default:(0,r.w5)((()=>[U])),_:1},8,["onClick"])])),_:1},8,["model"])):(0,r.kq)("",!0)])}var T=(0,r.aZ)({inject:["reload"],data(){return{addr:"",success:!1,fail:!1}},created(){S.Z.on("change1",(t=>{console.log(t),"success"==t.result?this.success=!0:this.fail=!0,this.addr=t.addr}))},methods:{reslut(){this.$router.push("/result")}}});const C=(0,v.Z)(T,[["render",K]]);var j=C,z={name:"StepForm",components:{StepTwo:_,StepThree:j},data(){return{currentTab:1,form:null,title:""}},methods:{nextStep(){this.currentTab<3&&(this.currentTab+=1)},prevStep(){this.currentTab>0&&(this.currentTab-=1)},finish(){this.currentTab=0}}};const Z=(0,v.Z)(z,[["render",i],["__scopeId","data-v-63653e7d"]]);var q=Z}}]);
//# sourceMappingURL=986.f7d39e8b.js.map