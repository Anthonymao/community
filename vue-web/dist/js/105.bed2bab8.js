"use strict";(self["webpackChunkvue_web"]=self["webpackChunkvue_web"]||[]).push([[105,399],{3105:function(e,t,a){a.r(t),a.d(t,{default:function(){return z}});var r=a(3396),s=a(9242);const l={class:"content"};function o(e,t,a,o,n,i){const d=(0,r.up)("StepTwo"),u=(0,r.up)("StepThree"),p=(0,r.up)("StepFour"),m=(0,r.up)("a-card");return(0,r.wg)(),(0,r.j4)(m,{bordered:!1},{default:(0,r.w5)((()=>[(0,r._)("div",l,[(0,r.wy)((0,r.Wm)(d,{onNextStep:i.nextStep,onPrevStep:i.prevStep},null,8,["onNextStep","onPrevStep"]),[[s.F8,1===n.currentTab]]),(0,r.wy)((0,r.Wm)(u,{onFinish:i.finish},null,8,["onFinish"]),[[s.F8,2===n.currentTab]]),(0,r.wy)((0,r.Wm)(p,{onFinish:i.finish},null,8,["onFinish"]),[[s.F8,3===n.currentTab]])])])),_:1})}var n=a(7139);const i=e=>((0,r.dD)("data-v-45e7c1f8"),e=e(),(0,r.Cn)(),e),d={style:{margin:"3px auto 0"}},u=i((()=>(0,r._)("h5",{style:{"text-align":"center",margin:"20px"}},"权重投票活动链上选票信息",-1))),p=(0,r.Uk)("选票信息"),m=(0,r.Uk)(" 本地生成秘密份额 "),c=(0,r.Uk)("上一步"),f=(0,r.Uk)("上传份额"),h=i((()=>(0,r._)("div",{class:"step-form-style-desc"},[(0,r._)("h3",null,"说明"),(0,r._)("h4",null,"加入匿名权重投票事项：请根据以上项目ID返回投票信息完成投票表决。")],-1)));function g(e,t,a,s,l,o){const i=(0,r.up)("a-descriptions-item"),g=(0,r.up)("a-descriptions"),w=(0,r.up)("a-tooltip"),S=(0,r.up)("a-table"),b=(0,r.up)("a-form-item"),y=(0,r.up)("upload-outlined"),v=(0,r.up)("a-button"),x=(0,r.up)("a-upload"),_=(0,r.up)("a-divider"),k=(0,r.up)("a-form");return(0,r.wg)(),(0,r.iD)("div",d,[(0,r.Wm)(k,{model:e.formState,name:"custom-validation",rules:e.rules,labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,r.w5)((()=>[u,(0,r.Wm)(b,{label:"投票信息",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(i,{label:"投票地址"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.formState.addr),1)])),_:1})])),_:1}),""!=e.formState.data?((0,r.wg)(),(0,r.j4)(S,{key:0,columns:e.columns,"data-source":e.formState.data,pagination:e.mypagination,size:"large",bordered:""},{bodyCell:(0,r.w5)((({column:e,text:t})=>["name"===e.dataIndex?((0,r.wg)(),(0,r.j4)(w,{key:0},{title:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(t),1)])),default:(0,r.w5)((()=>[(0,r.Uk)(" "+(0,n.zw)(t),1)])),_:2},1024)):(0,r.kq)("",!0)])),title:(0,r.w5)((()=>[p])),_:1},8,["columns","data-source","pagination"])):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(b,{label:"加密选票","has-feedback":"",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{showUploadList:!1,beforeUpload:e.beforeUpload1,accept:".txt",name:"file"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,{size:"large","html-type":"submit"},{default:(0,r.w5)((()=>[(0,r.Wm)(y),m])),_:1})])),_:1},8,["beforeUpload"])])),_:1}),(0,r.Wm)(b,{label:"秘密份额",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(i,{label:"匿名灵活活动秘密份额"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.formState.share),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(b,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Wm)(v,{type:"primary",onClick:e.prevStep},{default:(0,r.w5)((()=>[c])),_:1},8,["onClick"]),(0,r.Wm)(v,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:e.nextStepWe},{default:(0,r.w5)((()=>[f])),_:1},8,["onClick"])])),_:1}),(0,r.Wm)(_),h])),_:1},8,["model","rules"])])}var w=a(333),S=a(252),b=a(4870);const y=[{title:"ID",dataIndex:"0",ellipsis:!0},{title:"加密选票",dataIndex:"1",ellipsis:!0},{title:"选票签名",dataIndex:"2",ellipsis:!0}];var v=(0,r.aZ)({inject:["reload"],setup(){const e=(0,b.qj)({addr:"",vote:!1,share:"",C1:"",C2:"",data:[]});let t=async(e,t)=>""===t?Promise.reject("请根据要求操作"):Promise.resolve();const a={signature:[{required:!0,validator:t,trigger:"change"}]};return{rules:a,validateSignature:t,formState:e,columns:y,mypagination:{defaultPageSize:3}}},created(){console.log("chancan",this.$route.params.info),this.weresult(this.$route.params.info)},methods:{weresult(e){e=JSON.parse(e),"success"==e.result?(w.Z.emit("resballot",e),this.$emit("next3Step")):(this.formState.addr=e.addr,this.formState.data=e.ballot,this.formState.epub=e.epub)},beforeUpload1(e){return this.read1(e),!1},read1(e){const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=e=>{const t=e.target.result;var a=JSON.parse(t),r=this.formState.addr.indexOf(a.addr);if(console.log("indexshism",r),-1==r)S.ZP.destroy(),S.ZP.warning("文件上传错误，不是当前投票活动参数");else{var s=new Object;s.P=a.P,s.Q=a.Q,s.G=a.G;var l=this.formState.data;console.log("arr:",l);var o=this.formState.data.length,n=new Array(o),i=new Array(o),d=new Array(o);for(let e=0;e<o;e++)console.log(l[e][1]),n[e]=JSON.parse(l[e][1]),i[e]=JSON.stringify(n[e]),d[e]=l[e][2];var u=new Object,p=new Array,m=new Array,c=this.formState.epub.indexOf(a.elgamal_pk);for(let e=0;e<o;e++)p.push(n[e].x[c]),m.push(decrypt00(s,n[e].g_r,n[e].y[c],a.elgamal_sk));u.x=p,u.y=m,console.log("share:",u),this.formState.share=JSON.stringify(u)}}},prevStep(){this.$router.push("/result")},nextStepWe(){console.log(this.formState.share),""==this.formState.share&&(S.ZP.destroy(),S.ZP.warning("请点击并上传本地加密信息文件")),this.addshare()},addshare(){this.$http.post("http://192.168.5.42:8888/voteravc/upload_share",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),uid:sessionStorage.getItem("uid"),share:this.formState.share,C1:this.formState.C1,C2:this.formState.C2,addr:this.formState.addr}).then((e=>{console.log(e),"success"==e.data.result&&this.$emit("nextStep"),"error1"==e.data.result&&(S.ZP.destroy(),S.ZP.warning("请检查登录")),"error2"==e.data.result&&(S.ZP.destroy(),S.ZP.warning("上链失败！")),"error3"==e.data.result&&w.Z.emit("change",e.data)}))}}}),x=a(89);const _=(0,x.Z)(v,[["render",g],["__scopeId","data-v-45e7c1f8"]]);var k=_;const C={style:{margin:"40px auto 0"}},W=(0,r.Uk)(" 请等待其他投票参与方共同建立系统公钥，请及时关注获取投票结果。 "),I=(0,r.Uk)("获取结果");function P(e,t,a,s,l,o){const n=(0,r.up)("a-button"),i=(0,r.up)("a-result");return(0,r.wg)(),(0,r.iD)("div",C,[(0,r.Wm)(i,{status:"success",title:"您已经成功上传该投票活动的解密份额",model:e.formState},{subTitle:(0,r.w5)((()=>[W])),extra:(0,r.w5)((()=>[(0,r.Wm)(n,{key:"buy",onClick:e.result},{default:(0,r.w5)((()=>[I])),_:1},8,["onClick"])])),_:1},8,["model"])])}var U=(0,r.aZ)({inject:["reload"],methods:{result(){this.$router.push("/result")}}});const j=(0,x.Z)(U,[["render",P]]);var Z=j,T=a(2399),O={name:"StepForm",components:{StepTwo:k,StepThree:Z,StepFour:T["default"]},data(){return{currentTab:1,form:null,title:""}},methods:{nextStep(){this.currentTab<3&&(this.currentTab+=1)},next3Step(){this.currentTab<3&&(this.currentTab+=3)},prevStep(){this.currentTab>0&&(this.currentTab-=1)},finish(){this.currentTab=0}}};const q=(0,x.Z)(O,[["render",o],["__scopeId","data-v-72cf1b7c"]]);var z=q},2399:function(e,t,a){a.r(t),a.d(t,{default:function(){return b}});var r=a(3396),s=a(7139);const l=e=>((0,r.dD)("data-v-3734f3d4"),e=e(),(0,r.Cn)(),e),o={style:{margin:"3px auto 0"}},n=l((()=>(0,r._)("h5",{style:{"text-align":"center",margin:"20px"}},"权重投票活动链上选票信息汇总",-1))),i=(0,r.Uk)("选票信息"),d=(0,r.Uk)("上一步"),u=(0,r.Uk)("获取结果"),p=l((()=>(0,r._)("div",{class:"step-form-style-desc"},[(0,r._)("h3",null,"说明"),(0,r._)("h4",null,"加入匿名权重投票事项：请根据以上项目ID返回投票信息完成投票表决。")],-1)));function m(e,t,a,l,m,c){const f=(0,r.up)("a-descriptions-item"),h=(0,r.up)("a-descriptions"),g=(0,r.up)("a-tooltip"),w=(0,r.up)("a-table"),S=(0,r.up)("a-form-item"),b=(0,r.up)("a-spin"),y=(0,r.up)("a-button"),v=(0,r.up)("a-divider"),x=(0,r.up)("a-form"),_=(0,r.up)("a-card");return(0,r.wg)(),(0,r.j4)(_,{bordered:!1},{default:(0,r.w5)((()=>[(0,r._)("div",o,[(0,r.Wm)(x,{model:e.formState,name:"custom-validation",rules:e.rules,labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,r.w5)((()=>[n,(0,r.Wm)(S,{label:"投票信息",rules:[{required:!0}]},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{label:"投票地址"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formState.addr),1)])),_:1})])),_:1}),""!=e.formState.data?((0,r.wg)(),(0,r.j4)(w,{key:0,columns:e.columns,"data-source":e.formState.data,pagination:e.mypagination,size:"large",bordered:""},{bodyCell:(0,r.w5)((({column:e,text:t})=>["name"===e.dataIndex?((0,r.wg)(),(0,r.j4)(g,{key:0},{title:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t),1)])),default:(0,r.w5)((()=>[(0,r.Uk)(" "+(0,s.zw)(t),1)])),_:2},1024)):(0,r.kq)("",!0)])),title:(0,r.w5)((()=>[i])),_:1},8,["columns","data-source","pagination"])):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(S,{label:"统计结果",rules:[{required:!0}]},{default:(0,r.w5)((()=>[e.formState.result?((0,r.wg)(!0),(0,r.iD)(r.HY,{key:0},(0,r.Ko)(e.formState.result,(e=>((0,r.wg)(),(0,r.j4)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1},key:Date.now()},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{label:e[0]},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e[1]),1)])),_:2},1032,["label"])])),_:2},1024)))),128)):(0,r.kq)("",!0),""===e.formState.result&&""!==e.formState.click?((0,r.wg)(),(0,r.j4)(b,{key:1,size:"small"})):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(S,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Wm)(y,{type:"primary",onClick:e.prevStep},{default:(0,r.w5)((()=>[d])),_:1},8,["onClick"]),(0,r.Wm)(y,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:e.getres,disabled:""!==e.formState.click},{default:(0,r.w5)((()=>[u])),_:1},8,["onClick","disabled"])])),_:1}),(0,r.Wm)(v),p])),_:1},8,["model","rules"])])])),_:1})}a(333);var c=a(252),f=a(4870);const h=[{title:"ID",dataIndex:"0",ellipsis:!0},{title:"加密选票",dataIndex:"1",ellipsis:!0},{title:"选票签名",dataIndex:"2",ellipsis:!0}];var g=(0,r.aZ)({inject:["reload"],setup(){const e=(0,f.qj)({addr:"",res:"",sum:"",data:[],click:"",result:""});return{formState:e,columns:h,mypagination:{defaultPageSize:3}}},created(){console.log("chancan",this.$route.params.info),this.prevStep1(this.$route.params.info)},methods:{prevStep1(e){e=JSON.parse(e),this.formState.addr=e.addr,this.formState.data=e.ballot},prevStep(){this.$router.push("/result")},hex2str(e){var t,a=e.trim(),r="0x"===a.substr(0,2).toLowerCase()?a.substr(2):a,s=r.length;if(s%2!==0)return alert("Illegal Format ASCII Code!"),"";for(var l=[],o=0;o<s;o+=2)t=parseInt(r.substr(o,2),16),l.push(String.fromCharCode(t));return l.join("")},getres(){this.formState.click="click",this.$http.post("http://192.168.5.42:8888/voteravc/get_avc_result",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),addr:this.formState.addr}).then((e=>{if(console.log(e),"success"==e.data.result){console.log("jieguo:",e.data);var t=new Object;t.P=e.data.para[0],t.Q=e.data.para[1],t.G=e.data.para[2];var a=this.formState.data,r=e.data.para[4];console.log("K",r);var s=e.data.PK,l=this.formState.data.length,o=new Array(l),n=e.data.allshare;for(let e=0;e<l;e++)o[e]=JSON.parse(a[e][1]);var i=new Array;console.log("dsdsdsdsdsds",JSON.parse(n[0]));for(let e=0;e<l;e++){var d=new Array,u=new Array;for(let t=0;t<r;t++){console.log("dsds",n);var p=JSON.parse(n[t]);d.push(p.x[e]),u.push(p.y[e])}o[e].x=d,o[e].y=u,console.log("PK:",s[0]),i[e]=decrypt11(t,o[e],s[0],r)}for(let e=0;e<l;e++)i[e]=this.hex2str(i[e]),console.log(i[e]);var m={};i.forEach((function(e){m[e]=m[e]?m[e]+1:1})),console.log(m),this.formState.result=Object.entries(m),console.log(Object.entries(this.formState.result))}"error1"==e.data.result&&(c.ZP.destroy(),c.ZP.warning("请检查登录")),"wait"==e.data.result&&(c.ZP.destroy(),c.ZP.warning("请等候所有的参与者共同恢复结果"))}))}}}),w=a(89);const S=(0,w.Z)(g,[["render",m],["__scopeId","data-v-3734f3d4"]]);var b=S}}]);
//# sourceMappingURL=105.bed2bab8.js.map