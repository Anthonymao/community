(self["webpackChunkvue_web"]=self["webpackChunkvue_web"]||[]).push([[629],{6154:function(e,t,n){var a,o,r;(function(n,s){o=[],a=s,r="function"===typeof a?a.apply(t,o):a,void 0===r||(e.exports=r)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function a(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){l(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,i=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,t,n){var i=s.URL||s.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):o(l.href)?a(e,t,n):r(l,l.target="_blank")):(l.href=i.createObjectURL(e),setTimeout((function(){i.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,s){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,s),n);else if(o(e))a(e,n,s);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){r(i)}))}}:function(e,t,n,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return a(e,t,n);var r="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||r&&l||i)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},d.readAsDataURL(e)}else{var c=s.URL||s.webkitURL,p=c.createObjectURL(e);o?o.location=p:location.href=p,o=null,setTimeout((function(){c.revokeObjectURL(p)}),4e4)}});s.saveAs=l.saveAs=l,e.exports=l}))},2629:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var a=n(3396),o=n(7139),r=n(9242);const s={class:"content"};function i(e,t,n,i,l,u){const d=(0,a.up)("a-popover"),c=(0,a.up)("a-step"),p=(0,a.up)("a-steps"),f=(0,a.up)("StepTwo"),m=(0,a.up)("StepThree"),h=(0,a.up)("a-card");return(0,a.wg)(),(0,a.j4)(h,{bordered:!1},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{class:"steps",current:l.currentTab},{progressDot:(0,a.w5)((({index:e,status:t,prefixCls:n})=>[(0,a.Wm)(d,null,{content:(0,a.w5)((()=>[(0,a._)("span",null,"step "+(0,o.zw)(e)+" status: "+(0,o.zw)(t),1)])),default:(0,a.w5)((()=>[(0,a._)("span",{class:(0,o.C_)(`${n}-icon-dot`)},null,2)])),_:2},1024)])),default:(0,a.w5)((()=>[(0,a.Wm)(c,{title:"投票项目ID"}),(0,a.Wm)(c,{title:"加密套件"}),(0,a.Wm)(c,{title:"完成"})])),_:1},8,["current"]),(0,a._)("div",s,[(0,a.wy)((0,a.Wm)(f,{onNextStep:u.nextStep,onPrevStep:u.prevStep},null,8,["onNextStep","onPrevStep"]),[[r.F8,1===l.currentTab]]),(0,a.wy)((0,a.Wm)(m,{onFinish:u.finish},null,8,["onFinish"]),[[r.F8,2===l.currentTab]])])])),_:1})}const l=e=>((0,a.dD)("data-v-6a872bb8"),e=e(),(0,a.Cn)(),e),u={style:{margin:"3px auto 0"}},d=l((()=>(0,a._)("h5",{style:{"text-align":"center","margin-top":"20px"}},"本地生成加密套件",-1))),c=(0,a.Uk)(" 本地下载加密信息文件 "),p=(0,a.Uk)("上一步"),f=(0,a.Uk)("上传公钥"),m=l((()=>(0,a._)("div",{class:"step-form-style-desc"},[(0,a._)("h3",null,"说明"),(0,a._)("h4",null,"加入匿名权重投票事项：请根据以上项目ID返回投票信息完成投票表决。")],-1)));function h(e,t,n,r,s,i){const l=(0,a.up)("a-descriptions-item"),h=(0,a.up)("a-descriptions"),g=(0,a.up)("a-form-item"),w=(0,a.up)("PlusOutlined"),b=(0,a.up)("a-button"),v=(0,a.up)("a-divider"),S=(0,a.up)("a-form");return(0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(S,{model:e.formStateWe,name:"custom-validation",rules:e.rules,labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,a.w5)((()=>[d,(0,a.Wm)(g,{label:"加密参数",rules:[{required:!0}]},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{label:"投票地址"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.formStateWe.addr),1)])),_:1}),(0,a.Wm)(l,{label:"P"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.formStateWe.P),1)])),_:1}),(0,a.Wm)(l,{label:"Q"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.formStateWe.Q),1)])),_:1}),(0,a.Wm)(l,{label:"G"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.formStateWe.G),1)])),_:1})])),_:1})])),_:1}),(0,a.Wm)(g,{"has-feedback":"",label:"获取加密参数",name:"signature"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{size:"large",type:"dashed",style:{width:"80%"},onClick:e.generatepub,disabled:""!=e.formStateWe.spub},{default:(0,a.w5)((()=>[(0,a.Wm)(w),c])),_:1},8,["onClick","disabled"])])),_:1}),(0,a.Wm)(g,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{type:"primary",onClick:e.prevStep},{default:(0,a.w5)((()=>[p])),_:1},8,["onClick"]),(0,a.Wm)(b,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:e.nextStepWe},{default:(0,a.w5)((()=>[f])),_:1},8,["onClick"])])),_:1}),(0,a.Wm)(v),m])),_:1},8,["model","rules"])])}var g=n(333),w=n(4870),b=n(252),v=n(6154),S=(0,a.aZ)({inject:["reload"],setup(){const e=(0,w.qj)({addr:"",P:"",Q:"",G:"",spub:"",epub:"",vote:!1});let t=async(e,t)=>""===t?Promise.reject("请根据要求操作"):Promise.resolve();const n={signature:[{required:!0,validator:t,trigger:"change"}]};return{rules:n,validateSignature:t,formStateWe:e}},created(){console.log("chancan",this.$route.params.info),this.weinfo(this.$route.params.info)},methods:{weinfo(e){e=JSON.parse(e),console.log("ddddsdsd",e.addr),this.formStateWe.addr=e.addr,this.formStateWe.P=e.encryption[0],this.formStateWe.Q=e.encryption[1],this.formStateWe.G=e.encryption[2]},prevStep(){this.$router.push("/addvoting")},nextStep(){var e=[];""!==this.formState.signature&&this.formState.signature.length==this.formState.signature.split(" ").join("").length&&this.formState.pattern?(e.push({ID:this.formState.ID,ballot:this.formState.pattern,signature:this.formState.signature,vote:"avec"}),console.log("构造数据",e),g.Z.emit("upload",e),this.$emit("nextStep")):""!==this.formState.signature&&this.formState.signature.length==this.formState.signature.split(" ").join("").length&&this.formState.result.length&&(e.push({ID:this.formState.ID,ballot:this.formState.result,signature:this.formState.signature,vote:"avec"}),console.log("构造数据",e),g.Z.emit("upload",e),this.$emit("nextStep"))},generatepub(){var e=new Object;e.P=this.formStateWe.P,e.Q=this.formStateWe.Q,e.G=this.formStateWe.G;var t=generatekey(e);t.r=Math.round(1e5*Math.random()+2).toString();var n=new Object;n.x=t.ecdsa_pk_x,n.y=t.ecdsa_pk_y,this.formStateWe.spub=n,this.formStateWe.epub=t.pk,console.log("sdsdsdsdsd",this.formStateWe.spub,this.formStateWe.epub);var a=new Object;a.addr=this.formStateWe.addr;var o=Object.assign({},a,e,t);this.downloadTxt(o)},downloadTxt(e){let t=JSON.stringify(e),n=new Blob([t],{type:"text/plain;charset=utf-8"});(0,v.saveAs)(n,"权重密钥信息.txt"),b.ZP.destroy(),b.ZP.success("请注意保存权重密钥文件")},nextStepWe(){this.$http.post("http://192.168.5.42:8888/voterwe/we_upload_pk",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),uid:sessionStorage.getItem("uid"),voteaddr:this.formStateWe.addr,spub:Object.values(this.formStateWe.spub),epub:this.formStateWe.epub}).then((e=>{console.log(e),"success"===e.data.result&&this.$emit("nextStep"),"error1"==e.data.result&&(b.ZP.destroy(),b.ZP.warning("请检查登录")),"error2"==e.data.result&&(b.ZP.destroy(),b.ZP.warning("上链失败"),this.reload())})).catch((function(e){console.log(e)}))}}}),y=n(89);const W=(0,y.Z)(S,[["render",h],["__scopeId","data-v-6a872bb8"]]);var _=W;const k={style:{margin:"40px auto 0"}},x=(0,a.Uk)(" 请等待其他投票参与方共同建立系统公钥 "),T=(0,a.Uk)("开始投票");function j(e,t,n,o,r,s){const i=(0,a.up)("a-button"),l=(0,a.up)("a-result");return(0,a.wg)(),(0,a.iD)("div",k,[(0,a.Wm)(l,{status:"success",title:"您已经成功加入该投票活动",model:e.formState},{subTitle:(0,a.w5)((()=>[x])),extra:(0,a.w5)((()=>[(0,a.Wm)(i,{key:"buy",onClick:e.voting},{default:(0,a.w5)((()=>[T])),_:1},8,["onClick"])])),_:1},8,["model"])])}var U=(0,a.aZ)({inject:["reload"],methods:{voting(){this.$router.push("/voting")}}});const C=(0,y.Z)(U,[["render",j]]);var O=C,P={name:"StepForm",components:{StepTwo:_,StepThree:O},data(){return{currentTab:1,form:null,title:""}},methods:{nextStep(){this.currentTab<3&&(this.currentTab+=1)},prevStep(){this.currentTab>0&&(this.currentTab-=1)},finish(){this.currentTab=0}}};const D=(0,y.Z)(P,[["render",i],["__scopeId","data-v-362c166c"]]);var E=D}}]);
//# sourceMappingURL=629.0484e4bd.js.map