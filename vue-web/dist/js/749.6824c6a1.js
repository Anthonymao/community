"use strict";(self["webpackChunkvue_web"]=self["webpackChunkvue_web"]||[]).push([[749],{7749:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});var r=a(3396),s=a(7139),o=a(9242);const l={class:"content"};function i(e,t,a,i,n,u){const d=(0,r.up)("a-popover"),m=(0,r.up)("a-step"),p=(0,r.up)("a-steps"),f=(0,r.up)("StepTwo"),c=(0,r.up)("StepThree"),h=(0,r.up)("a-card");return(0,r.wg)(),(0,r.j4)(h,{bordered:!1},{default:(0,r.w5)((()=>[(0,r.Wm)(p,{class:"steps",current:n.currentTab},{progressDot:(0,r.w5)((({index:e,status:t,prefixCls:a})=>[(0,r.Wm)(d,null,{content:(0,r.w5)((()=>[(0,r._)("span",null,"step "+(0,s.zw)(e)+" status: "+(0,s.zw)(t),1)])),default:(0,r.w5)((()=>[(0,r._)("span",{class:(0,s.C_)(`${a}-icon-dot`)},null,2)])),_:2},1024)])),default:(0,r.w5)((()=>[(0,r.Wm)(m,{title:"投票项目ID"}),(0,r.Wm)(m,{title:"加密选票并上链"}),(0,r.Wm)(m,{title:"完成"})])),_:1},8,["current"]),(0,r._)("div",l,[(0,r.wy)((0,r.Wm)(f,{onNextStep:u.nextStep,onPrevStep:u.prevStep},null,8,["onNextStep","onPrevStep"]),[[o.F8,1===n.currentTab]]),(0,r.wy)((0,r.Wm)(c,{onFinish:u.finish},null,8,["onFinish"]),[[o.F8,2===n.currentTab]])])])),_:1})}const n=e=>((0,r.dD)("data-v-0ab81432"),e=e(),(0,r.Cn)(),e),u={style:{margin:"3px auto 0"}},d=n((()=>(0,r._)("h5",{style:{"text-align":"center","margin-top":"20px"}},"匿名权重投票活动信息",-1))),m=(0,r.Uk)("同意"),p=(0,r.Uk)("反对"),f=(0,r.Uk)("弃权"),c=(0,r.Uk)(" 本地读取加密信息并生成选票 "),h=(0,r.Uk)("上一步"),w=(0,r.Uk)("下一步"),W=n((()=>(0,r._)("div",{class:"step-form-style-desc"},[(0,r._)("h3",null,"说明"),(0,r._)("h4",null,"加入匿名权重投票事项：请根据以上项目ID返回投票信息完成投票表决。")],-1)));function g(e,t,a,o,l,i){const n=(0,r.up)("a-descriptions-item"),g=(0,r.up)("a-descriptions"),S=(0,r.up)("a-form-item"),b=(0,r.up)("a-radio"),_=(0,r.up)("a-radio-group"),v=(0,r.up)("upload-outlined"),k=(0,r.up)("a-button"),x=(0,r.up)("a-upload"),y=(0,r.up)("a-divider"),P=(0,r.up)("a-form");return(0,r.wg)(),(0,r.iD)("div",u,[(0,r.Wm)(P,{model:e.formStateWe,name:"custom-validation",rules:e.rules,labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:12}},style:{margin:"40px auto 0"},autocomplete:"off"},{default:(0,r.w5)((()=>[d,(0,r.Wm)(S,{label:"投票信息"},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"投票地址"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.addr),1)])),_:1}),(0,r.Wm)(n,{label:"决策主题"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.title),1)])),_:1}),(0,r.Wm)(n,{label:"决策内容"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.content),1)])),_:1}),(0,r.Wm)(n,{label:"投票截止时间"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.endTime),1)])),_:1})])),_:1}),(0,r.Wm)(g,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1},style:{"margin-top":"20px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"您的投票权重"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.weight),1)])),_:1}),(0,r.Wm)(n,{label:"构建的加密公钥"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.PK),1)])),_:1}),(0,r.Wm)(n,{label:"构建的加密公钥列表"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.PKlist),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(S,{label:"表决意愿",name:"choice","has-feedback":"",rules:[{required:!0,message:"请选择投票选项"}]},{default:(0,r.w5)((()=>[(0,r.Wm)(_,{size:"large",value:e.formStateWe.choice,"onUpdate:value":t[0]||(t[0]=t=>e.formStateWe.choice=t),style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(b,{span:8,value:"1"},{default:(0,r.w5)((()=>[m])),_:1}),(0,r.Wm)(b,{span:8,value:"-1"},{default:(0,r.w5)((()=>[p])),_:1}),(0,r.Wm)(b,{span:8,value:"0"},{default:(0,r.w5)((()=>[f])),_:1})])),_:1},8,["value"])])),_:1}),(0,r.Wm)(S,{label:"加密选票","has-feedback":""},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{showUploadList:!1,beforeUpload:e.beforeUpload,accept:".txt",name:"file"},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{size:"large","html-type":"submit",disabled:""===e.formStateWe.choice},{default:(0,r.w5)((()=>[(0,r.Wm)(v),c])),_:1},8,["disabled"])])),_:1},8,["beforeUpload"])])),_:1}),(0,r.Wm)(S,{label:"选票信息"},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{bordered:"true",column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1},style:{"margin-top":"20px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"权重表决加密"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.rawballot),1)])),_:1}),(0,r.Wm)(n,{label:"选票签名"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.formStateWe.signature),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(S,{wrapperCol:{span:24},style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{type:"primary",onClick:e.prevStep},{default:(0,r.w5)((()=>[h])),_:1},8,["onClick"]),(0,r.Wm)(k,{type:"primary","html-type":"submit",style:{"margin-left":"20px"},onClick:e.nextStepWe},{default:(0,r.w5)((()=>[w])),_:1},8,["onClick"])])),_:1}),(0,r.Wm)(y),W])),_:1},8,["model","rules"])])}var S=a(333),b=a(252),_=a(4870),v=(0,r.aZ)({inject:["reload"],setup(){const e=(0,_.qj)({addr:"",title:"",content:"",endTime:"",weight:"",spub:"",PKlist:[],PK:"",rawballot:"",signature:"",choice:"",vote:!1});let t=async(e,t)=>""===t?Promise.reject("请根据要求操作"):Promise.resolve();const a={signature:[{required:!0,validator:t,trigger:"change"}]};return{rules:a,validateSignature:t,formStateWe:e}},created(){console.log("chancan",this.$route.params.info),this.weinfo(this.$route.params.info)},methods:{weinfo(e){e=JSON.parse(e),this.formStateWe.addr=e.addr,this.formStateWe.title=e.voteinfo[0],this.formStateWe.content=e.voteinfo[2],this.formStateWe.endTime=e.voteinfo[1],this.formStateWe.weight=e.weight,this.formStateWe.PKlist=e.PKlist,this.formStateWe.PK=e.PK},beforeUpload(e){if(""!=this.formStateWe.choice)return this.read(e),!1;b.ZP.destroy(),b.ZP.warning("请先选择表决意愿！")},read(e){const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=e=>{const t=e.target.result;var a=JSON.parse(t),r=this.formStateWe.addr.indexOf(a.addr);if(console.log("indexshism",r),-1==r)b.ZP.destroy(),b.ZP.warning("文件上传错误，不是当前投票活动参数");else{var s=new Object;if(s.P=a.P,s.Q=a.Q,s.G=a.G,""==this.formStateWe.PK){var o=generatepub(s,this.formStateWe.PKlist,this.formStateWe.PKlist.length);console.log("系统公钥建立：",o),this.formStateWe.PK=o,this.setPK()}var l=this.formStateWe.choice*this.formStateWe.weight;this.formStateWe.rawballot=JSON.stringify(encrypt(s,a.r,this.formStateWe.PK,l,0));var i=new Object;i.x=a.ecdsa_pk_x,i.y=a.ecdsa_pk_y,this.formStateWe.signature=sign(this.formStateWe.rawballot,a.ecdsa_sk,i),this.formStateWe.spub=JSON.stringify(i),console.log("选票和签名",this.formStateWe.rawballot,this.formStateWe.signature)}}},setPK(){this.$http.post("http://192.168.5.42:8888/voterwe/upload_wePK",{PK:this.formStateWe.PK,addr:this.formStateWe.addr}).then((e=>{console.log(e)}))},prevStep(){this.$router.push("/voting")},nextStepWe(){console.log(this.formStateWe.PK),this.formStateWe.choice&&(""==this.formStateWe.signature&&(b.ZP.destroy(),b.ZP.warning("请点击并上传本地加密信息文件")),this.addweballot())},addweballot(){this.$http.post("http://192.168.5.42:8888/voterwe/add_we_ballot",{name:sessionStorage.getItem("user"),password:sessionStorage.getItem("pass"),uid:sessionStorage.getItem("uid"),ballotstr:this.formStateWe.rawballot,signature:JSON.stringify(this.formStateWe.signature),weight:this.formStateWe.weight,addr:this.formStateWe.addr,spub:this.formStateWe.spub,PK:this.formStateWe.PK}).then((e=>{console.log(e),"success"==e.data.result&&(S.Z.emit("change",e.data),console.log("jieguo:",e),S.Z.emit("info1",e.data),this.$emit("nextStep")),"error1"==e.data.result&&(b.ZP.destroy(),b.ZP.warning("请检查登录")),"error2"==e.data.result&&(b.ZP.destroy(),b.ZP.warning("没有找到对应投票项目")),"error3"==e.data.result&&S.Z.emit("change",e.data)}))}}}),k=a(89);const x=(0,k.Z)(v,[["render",g],["__scopeId","data-v-0ab81432"]]);var y=x;const P={style:{margin:"40px auto 0"}},U=(0,r.Uk)(" 该投票项目的合约地址:"),K=(0,r.Uk)("查看详情"),T=(0,r.Uk)(" 查询更多投票信息，请及时点击获取结果！ "),Z=(0,r.Uk)("查看详情");function C(e,t,a,o,l,i){const n=(0,r.up)("a-typography-title"),u=(0,r.up)("a-button"),d=(0,r.up)("a-result");return(0,r.wg)(),(0,r.iD)("div",P,[e.success?((0,r.wg)(),(0,r.j4)(d,{key:0,status:"success",title:"您的选票已成功上链，请及时点击获取投票结果！",model:e.formState},{subTitle:(0,r.w5)((()=>[U,(0,r.Wm)(n,{level:4},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(e.addr),1)])),_:1})])),extra:(0,r.w5)((()=>[(0,r.Wm)(u,{key:"buy",onClick:e.reslut},{default:(0,r.w5)((()=>[K])),_:1},8,["onClick"])])),_:1},8,["model"])):(0,r.kq)("",!0),e.fail?((0,r.wg)(),(0,r.j4)(d,{key:1,status:"error",title:"该投票项目已经超时，您的选票上链失败",model:e.formState},{subTitle:(0,r.w5)((()=>[T])),extra:(0,r.w5)((()=>[(0,r.Wm)(u,{key:"buy",onClick:e.reslut},{default:(0,r.w5)((()=>[Z])),_:1},8,["onClick"])])),_:1},8,["model"])):(0,r.kq)("",!0)])}var z=(0,r.aZ)({inject:["reload"],data(){return{addr:"",success:!1,fail:!1}},created(){S.Z.on("change",(e=>{console.log(e),"success"==e.result?this.success=!0:this.fail=!0,this.addr=e.addr}))},methods:{reslut(){this.$router.push("/result")}}});const j=(0,k.Z)(z,[["render",C]]);var O=j,$={name:"StepForm",components:{StepTwo:y,StepThree:O},data(){return{currentTab:1,form:null,title:""}},methods:{nextStep(){this.currentTab<3&&(this.currentTab+=1)},prevStep(){this.currentTab>0&&(this.currentTab-=1)},finish(){this.currentTab=0}}};const F=(0,k.Z)($,[["render",i],["__scopeId","data-v-6d1b4810"]]);var I=F}}]);
//# sourceMappingURL=749.6824c6a1.js.map